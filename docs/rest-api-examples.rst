REST API Example Usage
======================

This document summarizes some examples of the cloudigrade REST API.

..
    This document can be regenerated by a developer using the following
    make target from the root directory of a sandbox environment having
    database ports forwarded locally:

    make docs-api-examples

Examples here use the ``http`` command from
`httpie <https://httpie.org/>`_. If you want to follow along with these
exact commands, you may need to ``brew install httpie`` or
``pip install httpie`` first.

These examples also assume you are running cloudigrade on
``localhost:8080`` and that you have correctly configured
cloudigradeâ€™s environment with appropriate variables to allow it to talk
to the various clouds (e.g. ``AWS_ACCESS_KEY_ID``).

Authentication
--------------

Most requests to cloudigrade's APIs require a custom HTTP header ``X-RH-IDENTITY`` that
describes the caller's identity. For Red Hat "consoledot" services, this header is
normally populated automatically by a 3scale gateway, but this document will populate
it by using an ``HTTP_X_RH_IDENTITY`` environment variable.

The ``X-RH-IDENTITY`` header's value must contain the base64-encoded JSON data like:


.. code:: json

    {
        "identity": {
            "account_number": "100001",
            "user": {
                "is_org_admin": true
            }
        }
    }

.. code:: bash

    HTTP_X_RH_IDENTITY=eyJpZGVudGl0eSI6IHsiYWNjb3VudF9udW1iZXIiOiAiMTAwMDAxIiwgInVzZXIiOiB7ImlzX29yZ19hZG1pbiI6IHRydWV9fX0=

Some internal APIs may instead accept a combination of these custom HTTP headers:

* ``X-RH-CLOUDIGRADE-PSK`` contains a pre-shared key (secret)
* ``X-RH-CLOUDIGRADE-ACCOUNT-NUMBER`` contains the EBS account number for the user
* ``X-RH-CLOUDIGRADE-ORG-ID`` contains the consoledot org ID for the user

These three headers are not populated automatically by 3scale and must be explicitly
defined by the caller as needed. This document will populate them using the following
environment variables:

.. code:: bash

    HTTP_X_RH_CLOUDIGRADE_PSK=c17c6279-23c6-412f-8826-867323a7711a
    HTTP_X_RH_CLOUDIGRADE_ACCOUNT_NUMBER=109437
    HTTP_X_RH_CLOUDIGRADE_ORG_ID=658406

Overview
--------

The following resource paths are currently available:

-  ``/api/v2/accounts/`` returns accounts data
-  ``/api/v2/instances/`` returns instances data
-  ``/api/v2/images/`` returns images data
-  ``/api/v2/sysconfig/`` returns sysconfig data
-  ``/api/v2/azure-offer-template/`` returns azure offer template data
-  ``/api/v2/concurrent/`` returns concurrency data


User Setup
------------------

Users are not typically created via interaction with the HTTP APIs.
When accessing any endpoint with the ``X-RH-IDENTITY`` header,
if the user found in the header does not exist, it will not be created,
but not all APIs require that a corresponding cloudigrade user exists.


Customer Account Info
---------------------

List all accounts
~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/accounts/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 1138
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: fd13bf6d-e7c1-444a-89e6-996ad3f87bd8
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "account_arn": "arn:aws:iam::116325369465:role/role-for-cloudigrade",
                    "aws_account_id": "116325369465",
                    "aws_cloud_account_id": 1,
                    "created_at": "2020-05-04T00:00:00Z",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-04T00:00:00Z",
                "is_enabled": true,
                "platform_application_id": 6890,
                "platform_application_is_paused": false,
                "platform_authentication_id": 6311,
                "platform_source_id": 663,
                "updated_at": "2020-05-18T13:51:59.722367Z",
                "user_id": 1
            },
            {
                "account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_cloud_account_id": 1,
                    "created_at": "2020-05-04T00:00:00Z",
                    "subscription_id": "9ecc40fc-e888-4bb4-8f9a-e6254f19ba12",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-04T00:00:00Z",
                "is_enabled": true,
                "platform_application_id": 8376,
                "platform_application_is_paused": false,
                "platform_authentication_id": 4242,
                "platform_source_id": 7961,
                "updated_at": "2020-05-18T13:51:59.722367Z",
                "user_id": 1
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/accounts/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/accounts/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 2
        }
    }


Retrieve a specific account
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/accounts/1/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 496
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: caf8639b-963b-49dd-8c05-a8e200bd2e4d
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 1,
        "cloud_type": "aws",
        "content_object": {
            "account_arn": "arn:aws:iam::116325369465:role/role-for-cloudigrade",
            "aws_account_id": "116325369465",
            "aws_cloud_account_id": 1,
            "created_at": "2020-05-04T00:00:00Z",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-04T00:00:00Z",
        "is_enabled": true,
        "platform_application_id": 6890,
        "platform_application_is_paused": false,
        "platform_authentication_id": 6311,
        "platform_source_id": 663,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }


Instance Info
-------------

List all instances
~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 2611
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 81914155-107e-4c43-b1d3-4dc56862cf62
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-f3bda6fe8102c0fa7",
                    "region": "eu-west-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 1,
                "machine_image_id": 1,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-af3993a69e2ca7956",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 2,
                "machine_image_id": 2,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-2c876d8efb2a3fa67",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 3,
                "machine_image_id": 3,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/19c825da-b238-4bd1-92a2-e8ef889aae12/resourceGroups/interview/providers/Microsoft.Compute/virtualMachines/why",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 4,
                "machine_image_id": 4,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/31f6f82f-b71f-4a35-bacc-0fefad058b6c/resourceGroups/floor/providers/Microsoft.Compute/virtualMachines/me",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 5,
                "machine_image_id": 5,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "EAST US 2 EUAP",
                    "resource_id": "/subscriptions/19b3fc64-3342-4be7-bb78-d6e6eb912bb2/resourceGroups/wait/providers/Microsoft.Compute/virtualMachines/whatever",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 6,
                "machine_image_id": 6,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/instances/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/instances/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 6
        }
    }


Retrieve a specific instance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/1/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 350
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 0f29a4ef-203d-49ba-9455-0ef1097b6a24
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "cloud_account_id": 1,
        "cloud_type": "aws",
        "content_object": {
            "aws_instance_id": 1,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "ec2_instance_id": "i-f3bda6fe8102c0fa7",
            "region": "eu-west-1",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "instance_id": 1,
        "machine_image_id": 1,
        "updated_at": "2020-05-18T13:51:59.722367Z"
    }


Filtering instances
~~~~~~~~~~~~~~~~~~~

You may also include an optional "running_since" query string argument to filter for only
instances that have been running uninterrupted since the given time.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        running_since=="2020-05-18 13:51:59.722367+00:00"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 2365
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 7de3dd9a-b714-4cb2-a6cf-fc5a69099c77
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-f3bda6fe8102c0fa7",
                    "region": "eu-west-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 1,
                "machine_image_id": 1,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-af3993a69e2ca7956",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 2,
                "machine_image_id": 2,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/19c825da-b238-4bd1-92a2-e8ef889aae12/resourceGroups/interview/providers/Microsoft.Compute/virtualMachines/why",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 4,
                "machine_image_id": 4,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/31f6f82f-b71f-4a35-bacc-0fefad058b6c/resourceGroups/floor/providers/Microsoft.Compute/virtualMachines/me",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 5,
                "machine_image_id": 5,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "EAST US 2 EUAP",
                    "resource_id": "/subscriptions/19b3fc64-3342-4be7-bb78-d6e6eb912bb2/resourceGroups/wait/providers/Microsoft.Compute/virtualMachines/whatever",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 6,
                "machine_image_id": 6,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/instances/?limit=10&offset=0&running_since=2020-05-18+13%3A51%3A59.722367%2B00%3A00",
            "last": "/api/cloudigrade/v2/instances/?limit=10&offset=0&running_since=2020-05-18+13%3A51%3A59.722367%2B00%3A00",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 5
        }
    }


Machine Images
--------------

List all images
~~~~~~~~~~~~~~~

Below command will return all images that have been seen used by any instance for any account belonging to the user that makes the request.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/images/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 6922
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 62750c19-78c7-4605-8899-9e21a1521ab3
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-a26774e2",
                    "id": 1,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "116325369465",
                    "platform": "none",
                    "platform_details": null,
                    "product_codes": null,
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z",
                    "usage_operation": null
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 1,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-518f2244",
                    "id": 2,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "116325369465",
                    "platform": "none",
                    "platform_details": null,
                    "product_codes": null,
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z",
                    "usage_operation": null
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 2,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-0837b5ad",
                    "id": 3,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "116325369465",
                    "platform": "none",
                    "platform_details": null,
                    "product_codes": null,
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z",
                    "usage_operation": null
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 3,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 1,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/061fa230-9bd4-431e-a417-5ed5fb1d099b/resourceGroups/step/providers/Microsoft.Compute/images/themselves",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 4,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 2,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/9e19d542-1138-42a5-8d59-6f2e0f80770a/resourceGroups/help/providers/Microsoft.Compute/images/past",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 5,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 3,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/ac34f7c4-0ec9-4d28-9829-5787401e98eb/resourceGroups/discover/providers/Microsoft.Compute/images/mother",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 6,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/images/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/images/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 6
        }
    }


Retrieve a specific image
~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/images/1/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 1143
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 8ca65831-62c8-46c7-bd1c-e10f9cb3779d
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "architecture": "x86_64",
        "cloud_type": "aws",
        "content_object": {
            "aws_image_id": 1,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "ec2_ami_id": "ami-a26774e2",
            "id": 1,
            "is_cloud_access": false,
            "is_marketplace": false,
            "owner_aws_account_id": "116325369465",
            "platform": "none",
            "platform_details": null,
            "product_codes": null,
            "region": null,
            "updated_at": "2020-05-18T13:51:59.722367Z",
            "usage_operation": null
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "image_id": 1,
        "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
        "is_encrypted": false,
        "name": null,
        "openshift": false,
        "openshift_detected": false,
        "rhel": true,
        "rhel_detected": true,
        "rhel_detected_by_tag": false,
        "rhel_enabled_repos_found": true,
        "rhel_product_certs_found": false,
        "rhel_release_files_found": false,
        "rhel_signed_packages_found": false,
        "rhel_version": "7.7",
        "status": "inspected",
        "syspurpose": {
            "role": "Red Hat Enterprise Linux Server",
            "service_level_agreement": "Premium",
            "usage": "Development/Test"
        },
        "updated_at": "2020-05-18T13:51:59.722367Z"
    }


Report Commands
---------------

These APIs may be used to generate calculated and aggregated report data.

Daily Max Concurrency
~~~~~~~~~~~~~~~~~~~~~

The concurrency API returns a paginated list of days, and each day includes the
maximum concurrent number of instances, grouped by various combinations of role,
sla, and architecture seen concurrently in use during that day.

Optional ``start_date`` is an ISO-8601 date that is the inclusive start of the
reporting period. If not defined, default is "yesterday".

Optional ``end_date`` is an ISO-8601 date that is the exclusive end of the
reporting period. If not defined, default is "today".

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-11"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 17102
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 7287e27c-e88f-4ac1-80e2-097e534fd677
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "date": "2020-05-11",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-12",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-13",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-14",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-15",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-16",
                "maximum_counts": []
            },
            {
                "date": "2020-05-17",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/concurrent/?limit=10&offset=0&start_date=2020-05-11",
            "last": "/api/cloudigrade/v2/concurrent/?limit=10&offset=0&start_date=2020-05-11",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 7
        }
    }

If your requested ``start_date`` and ``end_date`` values would result in some
dates that not completed their calculations, the server will return ``425 Too Early``.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-04-17"

Response:

::

    HTTP/1.1 425 Too Early
    Allow: GET, HEAD, OPTIONS
    Content-Length: 64
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: d761954b-b7b4-4e78-90cc-1584deea0a10
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "detail": "Results are currently unavailable, try again later."
    }

If your requested ``start_date`` and ``end_date`` values would result in some
future dates beyond "yesterday", the API will return a 400 with the relevant errors.
Daily max concurrency results will end "yesterday" at the latest.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-17" \
        end_date=="2020-05-25"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 50
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 57b4f6bf-e651-4152-8986-25df419ac827
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date cannot be in the future."
        ]
    }

If your requested ``start_date`` and ``end_date`` values would result in exclusively
future dates beyond "yesterday", the API will also return a 400 with the relevant errors.
 In the following example, the request is for dates "tomorrow" through "one week from today".

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-19" \
        end_date=="2020-05-25"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 112
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 39210a4c-03c2-4872-94dc-29cc26dea775
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date cannot be in the future."
        ],
        "start_date": [
            "start_date cannot be today or in the future."
        ]
    }

If your requested ``end_date`` value is not greater then that of the user
``date_joined``, the api will return a 400 with the relevant error.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2018-12-18 00:00:00+00:00" \
        end_date=="2018-12-25 00:00:00+00:00"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 151
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: f75f8161-e687-4008-9217-adcbce84c299
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date must be same as or after the user creation date."
        ],
        "start_date": [
            "start_date must be same as or after the user creation date."
        ]
    }

Miscellaneous Commands
----------------------

Retrieve current publicly-viewable system configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The sysconfig endpoint includes the AWS cloud account id used by the application, AWS policies used for acting on behalf of customers, and the currently deployed backend version.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/sysconfig/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 680
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: a1ef56a6-1ff8-4eb6-9f4b-c9d920f5e963
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "aws_account_id": 991758150271,
        "aws_policies": {
            "traditional_inspection": {
                "Statement": [
                    {
                        "Action": [
                            "ec2:DescribeImages",
                            "ec2:DescribeInstances",
                            "ec2:ModifySnapshotAttribute",
                            "ec2:DescribeSnapshotAttribute",
                            "ec2:DescribeSnapshots",
                            "ec2:CopyImage",
                            "ec2:CreateTags",
                            "ec2:DescribeRegions",
                            "cloudtrail:CreateTrail",
                            "cloudtrail:UpdateTrail",
                            "cloudtrail:PutEventSelectors",
                            "cloudtrail:DescribeTrails",
                            "cloudtrail:StartLogging",
                            "cloudtrail:DeleteTrail"
                        ],
                        "Effect": "Allow",
                        "Resource": "*",
                        "Sid": "CloudigradePolicy"
                    }
                ],
                "Version": "2012-10-17"
            }
        },
        "azure_offer_template_path": "/api/cloudigrade/v2/azure-offer-template/",
        "version": "489-cloudigrade-version - d2b30c637ce3788e22990b21434bac2edcfb7ede"
    }

Retrieve anonymously viewable Azure Offer Template
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Azure Offer Template endpoint returns a json template populated with current running data, to be consumed by Azure to grant cloudigrade access to the customers account.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/azure-offer-template/

Response:

::

    HTTP/1.1 200 OK
    Access-Control-Allow-Origin: *
    Allow: GET, HEAD, OPTIONS
    Content-Length: 2017
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: f93bd15d-1298-4424-b500-34a8acbbf0e6
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "$schema": "https://schema.management.azure.com/schemas/2019-08-01/subscriptionDeploymentTemplate.json#",
        "contentVersion": "1.0.0.0",
        "outputs": {
            "authorizations": {
                "type": "array",
                "value": "[parameters('authorizations')]"
            },
            "mspOfferName": {
                "type": "string",
                "value": "[concat('Managed by', ' ', parameters('mspOfferName'))]"
            }
        },
        "parameters": {
            "authorizations": {
                "allowedValues": [
                    [
                        {
                            "principalId": "691f0b3e-exam-ple3-b03f-6eb5120acabb",
                            "principalIdDisplayName": "cloudigrade-rest-api-examples",
                            "roleDefinitionId": "acdd72a7-3385-48ef-bd42-f606fba81ae7"
                        }
                    ]
                ],
                "defaultValue": [
                    {
                        "principalId": "691f0b3e-exam-ple3-b03f-6eb5120acabb",
                        "principalIdDisplayName": "cloudigrade-rest-api-examples",
                        "roleDefinitionId": "acdd72a7-3385-48ef-bd42-f606fba81ae7"
                    }
                ],
                "type": "array"
            },
            "managedByTenantId": {
                "allowedValues": [
                    "81329282-exam-ple3-80af-f6457b5b32ad"
                ],
                "defaultValue": "81329282-exam-ple3-80af-f6457b5b32ad",
                "type": "string"
            },
            "mspOfferDescription": {
                "allowedValues": [
                    ""
                ],
                "defaultValue": "",
                "type": "string"
            },
            "mspOfferName": {
                "allowedValues": [
                    "cloudigrade-rest-api-examples"
                ],
                "defaultValue": "cloudigrade-rest-api-examples",
                "type": "string"
            }
        },
        "resources": [
            {
                "apiVersion": "2020-02-01-preview",
                "name": "[variables('mspRegistrationName')]",
                "properties": {
                    "authorizations": "[parameters('authorizations')]",
                    "description": "[parameters('mspOfferDescription')]",
                    "managedByTenantId": "[parameters('managedByTenantId')]",
                    "registrationDefinitionName": "[parameters('mspOfferName')]"
                },
                "type": "Microsoft.ManagedServices/registrationDefinitions"
            },
            {
                "apiVersion": "2020-02-01-preview",
                "dependsOn": [
                    "[resourceId('Microsoft.ManagedServices/registrationDefinitions/', variables('mspRegistrationName'))]"
                ],
                "name": "[variables('mspAssignmentName')]",
                "properties": {
                    "registrationDefinitionId": "[resourceId('Microsoft.ManagedServices/registrationDefinitions/', variables('mspRegistrationName'))]"
                },
                "type": "Microsoft.ManagedServices/registrationAssignments"
            }
        ],
        "variables": {
            "mspAssignmentName": "[guid(parameters('mspOfferName'))]",
            "mspRegistrationName": "[guid(parameters('mspOfferName'))]"
        }
    }


Internal APIs
-------------

The following APIs are only available internally and are not fully supported.
Caveat emptor. Hic sunt dracones.


Create an AWS account
~~~~~~~~~~~~~~~~~~~~~

This request may take a few seconds because of multiple round-trip calls
to the AWS APIs for each region. The "name" attribute is required and has a
maximum supported length of 256 characters. The "platform_authentication_id",
"platform_application_id", "platform_endpoint_id", and "platform_source_id"
attributes are all required and should be integers.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="aws" \
        account_arn="arn:aws:iam::335555691572:role/role-for-cloudigrade" \
        platform_authentication_id="4104" \
        platform_application_id="8725" \
        platform_source_id="9861"

Response:

::

    HTTP/1.1 201 Created
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 511
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: dff5aefb-cf1f-44dc-89fe-3009c864715f
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 3,
        "cloud_type": "aws",
        "content_object": {
            "account_arn": "arn:aws:iam::335555691572:role/role-for-cloudigrade",
            "aws_account_id": "335555691572",
            "aws_cloud_account_id": 2,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "is_enabled": true,
        "platform_application_id": 8725,
        "platform_application_is_paused": false,
        "platform_authentication_id": 4104,
        "platform_source_id": 9861,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }

If you attempt to create an AWS account for an ARN that is already in
the system, you should get a 400 error.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="aws" \
        account_arn="arn:aws:iam::335555691572:role/role-for-cloudigrade" \
        platform_authentication_id="2407" \
        platform_application_id="5081" \
        platform_source_id="1618"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 157
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 745bcaa1-13f4-4be6-af0a-7c41e606f185
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_arn": "Could not enable cloud metering. Error code CG1001. AWS ARN must be unique, but another cloud account with the same AWS ARN already exists."
    }


Create an Azure account
~~~~~~~~~~~~~~~~~~~~~
The "name" attribute is required and has a maximum supported length of 256 characters.
The "platform_authentication_id", "platform_application_id", "platform_endpoint_id",
and "platform_source_id" attributes are all required and should be integers.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ \
        "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="azure" \
        subscription_id="aa9192e0-373a-47c6-91e2-e3a0c780b286" \
        platform_authentication_id="1208" \
        platform_application_id="5409" \
        platform_source_id="7735"

Response:

::

    HTTP/1.1 201 Created
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 472
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 196ac627-bbf4-47ca-b26e-af6a077febdd
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 4,
        "cloud_type": "azure",
        "content_object": {
            "azure_cloud_account_id": 2,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "subscription_id": "aa9192e0-373a-47c6-91e2-e3a0c780b286",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "is_enabled": true,
        "platform_application_id": 5409,
        "platform_application_is_paused": false,
        "platform_authentication_id": 1208,
        "platform_source_id": 7735,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }


Search for a user
~~~~~~~~~~~~~~~~~

To search for and retrieve a user, you may filter using "account_number", "username"
(which simply maps to the account_number for backward compatibility), or "org_id".

Request:

.. code:: bash

    http localhost:8080/internal/api/cloudigrade/v1/users/ \
        "X-RH-CLOUDIGRADE-PSK:${HTTP_X_RH_CLOUDIGRADE_PSK}" \
        account_number=="100001"


::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 390
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: f653b840-145a-421f-9bb1-0758592d02d4
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "account_number": "100001",
                "date_joined": "2019-01-01T00:00:00Z",
                "id": 1,
                "org_id": null,
                "username": "100001",
                "uuid": "d862c2e3-6b0a-42f7-827c-67ebc8d44df7"
            }
        ],
        "links": {
            "first": "/internal/api/cloudigrade/v1/users/?account_number=100001&limit=10&offset=0",
            "last": "/internal/api/cloudigrade/v1/users/?account_number=100001&limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 1
        }
    }
