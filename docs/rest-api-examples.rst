REST API Example Usage
======================

This document summarizes some examples of the cloudigrade REST API.

..
    This document can be regenerated by a developer using the following
    make target from the root directory of a sandbox environment having
    database ports forwarded locally:

    make docs-api-examples

Examples here use the ``http`` command from
`httpie <https://httpie.org/>`_. If you want to follow along with these
exact commands, you may need to ``brew install httpie`` or
``pip install httpie`` first.

These examples also assume you are running cloudigrade on
``localhost:8080`` and that you have correctly configured
cloudigradeâ€™s environment with appropriate variables to allow it to talk
to the various clouds (e.g. ``AWS_ACCESS_KEY_ID``).

Authorization
-------------

The v2 API is authenticated with a custom HTTP header. In order to authenticate,
a `HTTP_X_RH_IDENTITY` header must be included in the request.
This header must be the base64 encoded version of:


.. code:: json

    {
        "identity": {
            "account_number": "1337",
            "user": {
                "is_org_admin": true
            }
        }
    }

.. code:: bash

    HTTP_X_RH_IDENTITY=eyJpZGVudGl0eSI6IHsiYWNjb3VudF9udW1iZXIiOiAiMTMzNyIsICJ1c2VyIjogeyJpc19vcmdfYWRtaW4iOiB0cnVlfX19

Overview
--------

The following resource paths are currently available:

-  ``/api/v2/accounts/`` returns accounts data
-  ``/api/v2/instances/`` returns instances data
-  ``/api/v2/images/`` returns images data
-  ``/api/v2/sysconfig/`` returns sysconfig data
-  ``/api/v2/concurrent/`` returns concurrency data


User Setup
------------------

When accessing any endpoint with the HTTP_X_RH_IDENTITY header,
if the user found in the header does not exist, it will not be created.


Customer Account Info
---------------------

List all accounts
~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/accounts/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 1163
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 84c299fd-13bf-4de7-8134-4a89e6996ad3
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "account_arn": "arn:aws:iam::544771852898:role/role-for-cloudigrade",
                    "aws_account_id": "544771852898",
                    "aws_cloud_account_id": 1,
                    "created_at": "2020-05-04T00:00:00Z",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-04T00:00:00Z",
                "is_enabled": true,
                "name": "greatest account ever",
                "platform_application_id": 6890,
                "platform_authentication_id": 6311,
                "platform_source_id": 663,
                "updated_at": "2020-05-18T13:51:59.722367Z",
                "user_id": 1
            },
            {
                "account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_cloud_account_id": 1,
                    "created_at": "2020-05-04T00:00:00Z",
                    "subscription_id": "67ebc8d4-4df7-4a5b-95e4-e83781234823",
                    "tenant_id": "c1189ecc-40fc-4888-bbb4-cf9ae6254f19",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-04T00:00:00Z",
                "is_enabled": true,
                "name": "meh account",
                "platform_application_id": 8376,
                "platform_authentication_id": 4242,
                "platform_source_id": 7961,
                "updated_at": "2020-05-18T13:51:59.722367Z",
                "user_id": 1
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/accounts/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/accounts/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 2
        }
    }


Retrieve a specific account
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/accounts/1/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 488
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: f87bd8ca-f863-4b96-bbd9-ddcc05a8e200
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 1,
        "cloud_type": "aws",
        "content_object": {
            "account_arn": "arn:aws:iam::544771852898:role/role-for-cloudigrade",
            "aws_account_id": "544771852898",
            "aws_cloud_account_id": 1,
            "created_at": "2020-05-04T00:00:00Z",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-04T00:00:00Z",
        "is_enabled": true,
        "name": "greatest account ever",
        "platform_application_id": 6890,
        "platform_authentication_id": 6311,
        "platform_source_id": 663,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }


Instance Info
-------------

List all instances
~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 2617
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: bd2e4d81-9141-4510-bedc-43f1d34dc568
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-af3bda6fe8102c0fa",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 1,
                "machine_image_id": 1,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-2af3993a69e2ca795",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 2,
                "machine_image_id": 2,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-12c876d8efb2a3fa6",
                    "region": "ca-central-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 3,
                "machine_image_id": 3,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "North Europe",
                    "resource_id": "/subscriptions/d00f19c8-25da-4238-8bd1-92a2e8ef889a/resourceGroups/interview/providers/Microsoft.Compute/virtualMachines/why",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 4,
                "machine_image_id": 4,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/9b0531f6-f82f-471f-ba35-bacc0fefad05/resourceGroups/floor/providers/Microsoft.Compute/virtualMachines/me",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 5,
                "machine_image_id": 5,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "North Europe",
                    "resource_id": "/subscriptions/0a9819b3-fc64-4342-9be7-bb78d6e6eb91/resourceGroups/wait/providers/Microsoft.Compute/virtualMachines/whatever",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 6,
                "machine_image_id": 6,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/instances/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/instances/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 6
        }
    }


Retrieve a specific instance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/1/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 355
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 62cf620f-29a4-4f20-bd49-bad4550ef109
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "cloud_account_id": 1,
        "cloud_type": "aws",
        "content_object": {
            "aws_instance_id": 1,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "ec2_instance_id": "i-af3bda6fe8102c0fa",
            "region": "ap-northeast-1",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "instance_id": 1,
        "machine_image_id": 1,
        "updated_at": "2020-05-18T13:51:59.722367Z"
    }


Filtering instances
~~~~~~~~~~~~~~~~~~~

You may also include an optional "running_since" query string argument to filter for only
instances that have been running uninterrupted since the given time.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/instances/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        running_since=="2020-05-18 13:51:59.722367+00:00"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 2373
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 7b6a247d-e3dd-4ab7-94ac-b226cffc5a69
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-af3bda6fe8102c0fa",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 1,
                "machine_image_id": 1,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 1,
                "cloud_type": "aws",
                "content_object": {
                    "aws_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_instance_id": "i-2af3993a69e2ca795",
                    "region": "ap-northeast-1",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 2,
                "machine_image_id": 2,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "North Europe",
                    "resource_id": "/subscriptions/d00f19c8-25da-4238-8bd1-92a2e8ef889a/resourceGroups/interview/providers/Microsoft.Compute/virtualMachines/why",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 4,
                "machine_image_id": 4,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "East US",
                    "resource_id": "/subscriptions/9b0531f6-f82f-471f-ba35-bacc0fefad05/resourceGroups/floor/providers/Microsoft.Compute/virtualMachines/me",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 5,
                "machine_image_id": 5,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "cloud_account_id": 2,
                "cloud_type": "azure",
                "content_object": {
                    "azure_instance_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "region": "North Europe",
                    "resource_id": "/subscriptions/0a9819b3-fc64-4342-9be7-bb78d6e6eb91/resourceGroups/wait/providers/Microsoft.Compute/virtualMachines/whatever",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "instance_id": 6,
                "machine_image_id": 6,
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/instances/?limit=10&offset=0&running_since=2020-05-18+13%3A51%3A59.722367%2B00%3A00",
            "last": "/api/cloudigrade/v2/instances/?limit=10&offset=0&running_since=2020-05-18+13%3A51%3A59.722367%2B00%3A00",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 5
        }
    }


Machine Images
--------------

List all images
~~~~~~~~~~~~~~~

Below command will return all images that have been seen used by any instance for any account belonging to the user that makes the request.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/images/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 6718
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 099c7762-750c-4978-8726-0508999e21a1
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-7a26774e",
                    "id": 1,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "544771852898",
                    "platform": "none",
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 1,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-6518f224",
                    "id": 2,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "544771852898",
                    "platform": "none",
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 2,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "aws",
                "content_object": {
                    "aws_image_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "ec2_ami_id": "ami-70837b5a",
                    "id": 3,
                    "is_cloud_access": false,
                    "is_marketplace": false,
                    "owner_aws_account_id": "544771852898",
                    "platform": "none",
                    "region": null,
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 3,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 1,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 1,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/ae12061f-a230-4bd4-931e-64175ed5fb1d/resourceGroups/step/providers/Microsoft.Compute/images/themselves",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 4,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 2,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 2,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/8b6c9e19-d542-4138-92a5-4d596f2e0f80/resourceGroups/help/providers/Microsoft.Compute/images/past",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 5,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            },
            {
                "architecture": "x86_64",
                "cloud_type": "azure",
                "content_object": {
                    "azure_image_id": 3,
                    "created_at": "2020-05-18T13:51:59.722367Z",
                    "id": 3,
                    "is_marketplace": false,
                    "region": null,
                    "resource_id": "/subscriptions/2bb2ac34-f7c4-4ec9-ad28-d8295787401e/resourceGroups/discover/providers/Microsoft.Compute/images/mother",
                    "updated_at": "2020-05-18T13:51:59.722367Z"
                },
                "created_at": "2020-05-18T13:51:59.722367Z",
                "image_id": 6,
                "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
                "is_encrypted": false,
                "name": null,
                "openshift": false,
                "openshift_detected": false,
                "rhel": true,
                "rhel_detected": true,
                "rhel_detected_by_tag": false,
                "rhel_enabled_repos_found": true,
                "rhel_product_certs_found": false,
                "rhel_release_files_found": false,
                "rhel_signed_packages_found": false,
                "rhel_version": "7.7",
                "status": "inspected",
                "syspurpose": {
                    "role": "Red Hat Enterprise Linux Server",
                    "service_level_agreement": "Premium",
                    "usage": "Development/Test"
                },
                "updated_at": "2020-05-18T13:51:59.722367Z"
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/images/?limit=10&offset=0",
            "last": "/api/cloudigrade/v2/images/?limit=10&offset=0",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 6
        }
    }


Retrieve a specific image
~~~~~~~~~~~~~~~~~~~~~~~~~

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/images/1/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 1075
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 521ab38c-a658-4162-88c6-c77d1ce10f9c
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "architecture": "x86_64",
        "cloud_type": "aws",
        "content_object": {
            "aws_image_id": 1,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "ec2_ami_id": "ami-7a26774e",
            "id": 1,
            "is_cloud_access": false,
            "is_marketplace": false,
            "owner_aws_account_id": "544771852898",
            "platform": "none",
            "region": null,
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "image_id": 1,
        "inspection_json": "{\"rhel_enabled_repos_found\": true, \"rhel_version\": \"7.7\", \"syspurpose\": {\"role\": \"Red Hat Enterprise Linux Server\", \"service_level_agreement\": \"Premium\", \"usage\": \"Development/Test\"}}",
        "is_encrypted": false,
        "name": null,
        "openshift": false,
        "openshift_detected": false,
        "rhel": true,
        "rhel_detected": true,
        "rhel_detected_by_tag": false,
        "rhel_enabled_repos_found": true,
        "rhel_product_certs_found": false,
        "rhel_release_files_found": false,
        "rhel_signed_packages_found": false,
        "rhel_version": "7.7",
        "status": "inspected",
        "syspurpose": {
            "role": "Red Hat Enterprise Linux Server",
            "service_level_agreement": "Premium",
            "usage": "Development/Test"
        },
        "updated_at": "2020-05-18T13:51:59.722367Z"
    }


Report Commands
---------------

These APIs may be used to generate calculated and aggregated report data.

Daily Max Concurrency
~~~~~~~~~~~~~~~~~~~~~

The concurrency API returns a paginated list of days, and each day includes the
maximum concurrent number of instances, grouped by various combinations of role,
sla, and architecture seen concurrently in use during that day.

Optional ``start_date`` is an ISO-8601 date that is the inclusive start of the
reporting period. If not defined, default is "yesterday".

Optional ``end_date`` is an ISO-8601 date that is the exclusive end of the
reporting period. If not defined, default is "today".

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-11"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 17102
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 42b32872-87e2-4ce8-8f9a-c100e2097e53
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "data": [
            {
                "date": "2020-05-11",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-12",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-13",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-14",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-15",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            },
            {
                "date": "2020-05-16",
                "maximum_counts": []
            },
            {
                "date": "2020-05-17",
                "maximum_counts": [
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "x86_64",
                        "instances_count": 5,
                        "role": "_ANY",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "_ANY",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "_ANY"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "_ANY",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    },
                    {
                        "arch": "_ANY",
                        "instances_count": 5,
                        "role": "Red Hat Enterprise Linux Server",
                        "service_type": "",
                        "sla": "Premium",
                        "usage": "Development/Test"
                    }
                ]
            }
        ],
        "links": {
            "first": "/api/cloudigrade/v2/concurrent/?limit=10&offset=0&start_date=2020-05-11",
            "last": "/api/cloudigrade/v2/concurrent/?limit=10&offset=0&start_date=2020-05-11",
            "next": null,
            "previous": null
        },
        "meta": {
            "count": 7
        }
    }

If your requested ``start_date`` and ``end_date`` values would result in some
dates that not completed their calculations, the server will return ``425 Too Early``.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-04-17"

Response:

::

    HTTP/1.1 425
    Allow: GET, HEAD, OPTIONS
    Content-Length: 64
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 9ac827d7-6195-4bb7-b4ce-7810cc1584de
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "detail": "Results are currently unavailable, try again later."
    }

If your requested ``start_date`` and ``end_date`` values would result in some
future dates beyond "yesterday", the API will return a 400 with the relevant errors.
Daily max concurrency results will end "yesterday" at the latest.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-17" \
        end_date=="2020-05-25"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 50
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: ee380257-b4f6-4fe6-91d1-52098625df41
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date cannot be in the future."
        ]
    }

If your requested ``start_date`` and ``end_date`` values would result in exclusively
future dates beyond "yesterday", the API will also return a 400 with the relevant errors.
 In the following example, the request is for dates "tomorrow" through "one week from today".

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2020-05-19" \
        end_date=="2020-05-25"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 112
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: ea0a1039-210a-4c03-82d8-7254dc29cc26
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date cannot be in the future."
        ],
        "start_date": [
            "start_date cannot be today or in the future."
        ]
    }

If your requested ``end_date`` value is not greater then that of the user
``date_joined``, the api will return a 400 with the relevant error.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/concurrent/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        start_date=="2018-12-18 00:00:00+00:00" \
        end_date=="2018-12-25 00:00:00+00:00"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, HEAD, OPTIONS
    Content-Length: 74
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: dea775f7-5f81-41e6-8780-089217adcbce
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "end_date": [
            "end_date must be same as or after the user creation date."
        ]
    }

Miscellaneous Commands
----------------------

Retrieve current publicly-viewable system configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The sysconfig endpoint includes the AWS cloud account id used by the application, AWS policies used for acting on behalf of customers, and the currently deployed backend version.

Request:

.. code:: bash

    http localhost:8080/api/cloudigrade/v2/sysconfig/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}"

Response:

::

    HTTP/1.1 200 OK
    Allow: GET, HEAD, OPTIONS
    Content-Length: 608
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: b3779da1-ef56-461f-b8ae-b69f4bc9d920
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "aws_account_id": 434533559245,
        "aws_policies": {
            "traditional_inspection": {
                "Statement": [
                    {
                        "Action": [
                            "ec2:DescribeImages",
                            "ec2:DescribeInstances",
                            "ec2:ModifySnapshotAttribute",
                            "ec2:DescribeSnapshotAttribute",
                            "ec2:DescribeSnapshots",
                            "ec2:CopyImage",
                            "ec2:CreateTags",
                            "ec2:DescribeRegions",
                            "cloudtrail:CreateTrail",
                            "cloudtrail:UpdateTrail",
                            "cloudtrail:PutEventSelectors",
                            "cloudtrail:DescribeTrails",
                            "cloudtrail:StartLogging",
                            "cloudtrail:DeleteTrail"
                        ],
                        "Effect": "Allow",
                        "Resource": "*",
                        "Sid": "CloudigradePolicy"
                    }
                ],
                "Version": "2012-10-17"
            }
        },
        "version": "489-cloudigrade-version - d2b30c637ce3788e22990b21434bac2edcfb7ede"
    }


Internal APIs
-------------

The following APIs are only available internally and are not fully supported.
Caveat emptor. Hic sunt dracones.


Create an AWS account
~~~~~~~~~~~~~~~~~~~~~

This request may take a few seconds because of multiple round-trip calls
to the AWS APIs for each region. The "name" attribute is required and has a
maximum supported length of 256 characters. The "platform_authentication_id",
"platform_application_id", "platform_endpoint_id", and "platform_source_id"
attributes are all required and should be integers.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="aws" \
        account_arn="arn:aws:iam::887838253945:role/role-for-cloudigrade" \
        name="yet another account" \
        platform_authentication_id="1553" \
        platform_application_id="4104" \
        platform_source_id="8725"

Response:

::

    HTTP/1.1 201 Created
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 501
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: f5aefbcf-1f84-4cc9-be30-09c864715fc1
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 3,
        "cloud_type": "aws",
        "content_object": {
            "account_arn": "arn:aws:iam::887838253945:role/role-for-cloudigrade",
            "aws_account_id": "887838253945",
            "aws_cloud_account_id": 2,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "is_enabled": true,
        "name": "yet another account",
        "platform_application_id": 4104,
        "platform_authentication_id": 1553,
        "platform_source_id": 8725,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }

If you attempt to create an AWS account for an ARN that is already in
the system, you should get a 400 error.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="aws" \
        account_arn="arn:aws:iam::887838253945:role/role-for-cloudigrade" \
        name="but this account already exists" \
        platform_authentication_id="1618" \
        platform_application_id="1208" \
        platform_source_id="5409"

Response:

::

    HTTP/1.1 400 Bad Request
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 93
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 5bcaa113-f40b-46ef-8a7c-41e606f185aa
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_arn": "Could not set up cloud metering. Please contact support. Error code CG1001."
    }


Create an Azure account
~~~~~~~~~~~~~~~~~~~~~
The "name" attribute is required and has a maximum supported length of 256 characters.
The "platform_authentication_id", "platform_application_id", "platform_endpoint_id",
and "platform_source_id" attributes are all required and should be integers.

Request:

.. code:: bash

    http post localhost:8080/internal/api/cloudigrade/v1/accounts/ "X-RH-IDENTITY:${HTTP_X_RH_IDENTITY}" \
        cloud_type="azure" \
        subscription_id="814ef21d-256d-4490-acec-15ef1a6a1019" \
        tenant_id="9192e037-3a17-46d1-a2e3-a0c780b2866b" \
        name="it's an azure account" \
        platform_authentication_id="7113" \
        platform_application_id="5180" \
        platform_source_id="3350"

Response:

::

    HTTP/1.1 201 Created
    Allow: GET, POST, HEAD, OPTIONS
    Content-Length: 515
    Content-Type: application/json
    Referrer-Policy: same-origin
    X-CLOUDIGRADE-REQUEST-ID: 53b84014-5a12-4f5b-b107-58592d02d4f9
    X-Content-Type-Options: nosniff
    X-Frame-Options: DENY

    {
        "account_id": 4,
        "cloud_type": "azure",
        "content_object": {
            "azure_cloud_account_id": 2,
            "created_at": "2020-05-18T13:51:59.722367Z",
            "subscription_id": "814ef21d-256d-4490-acec-15ef1a6a1019",
            "tenant_id": "9192e037-3a17-46d1-a2e3-a0c780b2866b",
            "updated_at": "2020-05-18T13:51:59.722367Z"
        },
        "created_at": "2020-05-18T13:51:59.722367Z",
        "is_enabled": true,
        "name": "it's an azure account",
        "platform_application_id": 5180,
        "platform_authentication_id": 7113,
        "platform_source_id": 3350,
        "updated_at": "2020-05-18T13:51:59.722367Z",
        "user_id": 1
    }
